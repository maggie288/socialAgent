# 本机代码如何部署到公网（从零说清楚）

你本机有一个「socialAgent」项目，里面有一个 **Web 投喂入口**（聊天页面）。部署的意思就是：**把这个聊天页面放到一台 24 小时开着的、别人能访问的服务器上**，这样你发一个链接给朋友，他们打开就能和你的分身聊天。

下面用**最简单的方式**说清楚：要准备什么、选哪种方式、每一步怎么做。

---

## 一、先搞清楚「要部署的是哪部分」

| 东西 | 在哪 | 要不要你部署 |
|------|------|--------------|
| **OpenClaw（分身大脑）** | 你已经放在阿里云了 | ✅ 你已经做好了 |
| **本仓库里的 Web 聊天页** | 你 Mac 上的 `socialAgent/web` 文件夹 | ✅ 需要部署到公网，别人才能用链接打开 |

所以：**你要部署的只是「本机这段 Web 程序」**，让它能在公网被访问。OpenClaw 留在阿里云不动。

---

## 二、部署前你本机要准备好两样

1. **代码已经在 GitHub 上**  
   - 若还没有：在 GitHub 新建一个仓库，把本机 `socialAgent` 整个项目推送上去（不要推送 `.env` 和 `memory/` 里的敏感文件）。  
   - 若不会用 Git：可以用 GitHub 网页上的「Upload files」把 `web` 文件夹里的内容（app.py、requirements.txt、templates、translations）打包上传到一个仓库里。

2. **两个信息**（从阿里云 OpenClaw 来）：  
   - **OpenClaw 地址**：`http://你的公网IP:端口`，例如 `http://47.85.44.90:19448`  
   - **OpenClaw Token**：在 OpenClaw Web 控制台「获取 Token」里复制的那一串  

这两样后面会填到「部署平台」的环境变量里，不要写进代码、不要提交到 GitHub。

---

## 三、选一种方式把 Web 部署出去（二选一）

### 方式一：用 Railway 部署（推荐，不用买服务器）

**适合**：不想买阿里云第二台机器、不想管服务器，只要一个能打开的链接。

**大致流程**：把你的代码仓库连到 Railway → Railway 帮你把 `web` 跑起来 → 给你一个 https 链接。

**具体步骤**：

1. **注册 Railway**  
   - 打开 https://railway.app ，用 GitHub 账号登录（没有就先注册 GitHub）。

2. **新建项目并连上仓库**  
   - 点 **New Project** → 选 **Deploy from GitHub repo**。  
   - 选中你放 socialAgent 代码的那个仓库（若只上传了 `web` 就选那个仓库）。  
   - 授权 Railway 访问该仓库。

3. **告诉 Railway 跑的是哪个目录**  
   - 在项目里选中这个服务，进 **Settings** 或 **Variables** 所在页面。  
   - 找到 **Root Directory**（根目录）或 **Source** 相关设置：填 **`web`**（表示用仓库里的 `web` 文件夹作为项目根）。  
   - 若没有 Root Directory：后面在 Build/Start 命令里要写清楚在 `web` 下执行。

4. **填环境变量**  
   - 找到 **Variables**，点 **Add Variable** 或 **RAW Editor**，新增三个（名字和值都按下面来）：  
     - `OPENCLAW_URL` = `http://你的公网IP:端口`（例如 `http://47.85.44.90:19448`）  
     - `OPENCLAW_TOKEN` = 你复制的 Token  
     - `FLASK_ENV` = `production`

5. **设置启动命令（如果需要）**  
   - 在 **Settings** 里找 **Deploy** / **Start Command** 或 **Build Command**。  
   - 若平台没有自动识别：  
     - Build：`pip install -r requirements.txt`（在 `web` 目录下执行）  
     - Start：`gunicorn --bind 0.0.0.0:$PORT --workers 2 --threads 2 app:app`  
   - 若已有 **Procfile** 且 Root 是 `web`，一般会自动用 Procfile，不用再填。

6. **等部署完成**  
   - 部署成功后，Railway 会给你一个 **域名**，像 `xxx.up.railway.app`。  
   - 点进去或「Generate Domain」生成一个，用浏览器打开这个 https 链接，能打开聊天页、能发消息并收到分身回复，就说明部署成功。

这样你的「本机代码」就相当于部署到了 Railway 的服务器上，本机不用一直开着。

---

### 方式二：部署到阿里云（和 OpenClaw 同一云）

**适合**：希望 Web 和 OpenClaw 都在阿里云、方便统一管理。

**大致流程**：在阿里云再买一台轻量/ECS（或和 OpenClaw 同一台机子多开一个服务），把本机 `web` 代码上传上去，在服务器上安装 Python、装依赖、用 Gunicorn 跑起来，并配置 Nginx 或直接暴露端口。

**具体步骤**：

1. **有一台能公网访问的服务器**  
   - 可以是一台新的轻量应用服务器（最便宜即可），或和 OpenClaw 同一台（需内存够用）。  
   - 系统选 **Ubuntu 22.04** 或 **Alibaba Cloud Linux**。  
   - 安全组放通一个端口，例如 **5000** 或 **80**（若用 Nginx 反向代理可只开 80/443）。

2. **在本机打包要上传的文件**  
   - 把本机 `socialAgent/web` 里的这些**整体**打成 zip 或直接准备上传：  
     - `app.py`  
     - `requirements.txt`  
     - `templates/` 文件夹（里面 chat.html）  
     - `translations/` 文件夹（里面所有 .json）  
   - **不要**把 `.env` 或本机的密钥打包进去。

3. **上传到服务器**  
   - 用 SFTP、SCP 或阿里云控制台的「文件上传」功能，把上面这些放到服务器的一个目录里，例如 `/home/ubuntu/web` 或 `/root/foodie-twin-web`。

4. **在服务器上安装环境并运行**  
   - SSH 登录服务器后执行（路径按你实际放的位置改）：  
   ```bash
   cd /home/ubuntu/web    # 改成你放的目录
   sudo apt update
   sudo apt install -y python3 python3-pip
   pip3 install -r requirements.txt
   export OPENCLAW_URL="http://你的OpenClaw公网IP:19448"
   export OPENCLAW_TOKEN="你的Token"
   export FLASK_ENV=production
   export PORT=5000
   gunicorn --bind 0.0.0.0:5000 --workers 2 --threads 2 app:app
   ```  
   - 若希望关掉 SSH 也继续跑，可以用 `nohup ... &` 或 systemd 做成服务（后面可再查「linux gunicorn 开机自启」）。

5. **在阿里云安全组里放通 5000 端口**（若用 5000）  
   - 入方向规则：TCP 5000，来源 0.0.0.0/0（测试用）；正式可改成只允许你或 Nginx 所在机访问。

6. **浏览器访问**  
   - 打开 `http://你的这台服务器公网IP:5000`，能出现聊天页、能对话即部署成功。  
   - 若想要 https 或 80 端口，再在服务器上装 Nginx 做反向代理即可（可另写一份 Nginx 配置说明）。

---

## 四、总结成一句话

- **本机代码** = 你 Mac 上的 `socialAgent` 项目里的 **Web 部分**（`web` 文件夹）。  
- **部署** = 把这段 Web 放到「一台公网能访问的机器」上并跑起来。  
- **两种做法**：  
  - 不想管服务器 → 用 **Railway**（方式一）：连 GitHub，填 `OPENCLAW_URL`、`OPENCLAW_TOKEN`，拿 https 链接。  
  - 想都放阿里云 → 用 **阿里云一台机**（方式二）：上传 `web` 代码，装 Python 和依赖，用 Gunicorn 跑，安全组放通端口。

部署完成后，把你得到的链接（Railway 的 https 或阿里云的 http://IP:5000）发给别人，他们就能打开和你分身聊天。若你告诉我选的是「Railway」还是「阿里云」，我可以按你选的再写一版更细的点击步骤（只写那一种）。
